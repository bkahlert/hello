package com.bkahlert.semanticui.test

/**
 * Sets a generic cycle-proof `toString` function on the `prototype` of
 * - `Object`
 * - `Array`
 * - `Element`
 * - `jQuery`
 */
public val GenericToStringLibrary: Library by lazy { Library("GenericToString", GENERIC_TO_STRING_LIBRARY) }

@Suppress("LongLine", "SpellCheckingInspection")
private const val GENERIC_TO_STRING_LIBRARY: String =
    "KGZ1bmN0aW9uICgpIHsNCiAgICBpZiAodHlwZW9mIEpTT04uZGVjeWNsZSAhPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgSlNPTi5kZWN5Y2xlID0gZnVuY3Rpb24gZGVjeWNsZSAob2JqZWN0LCByZXBsYWNlcikgew0KICAgICAgICAndXNlIHN0cmljdCc7DQogICAgICAgIHZhciBvYmplY3RzID0gbmV3IFdlYWtNYXAoKTsNCiAgICAgICAgcmV0dXJuIChmdW5jdGlvbiBkZXJleiAodmFsdWUsIHBhdGgpIHsNCiAgICAgICAgICB2YXIgb2xkX3BhdGg7DQogICAgICAgICAgdmFyIG51Ow0KICAgICAgICAgIGlmIChyZXBsYWNlciAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICB2YWx1ZSA9IHJlcGxhY2VyKHZhbHVlKTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKA0KICAgICAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jw0KICAgICAgICAgICAgJiYgdmFsdWUgIT09IG51bGwNCiAgICAgICAgICAgICYmICEodmFsdWUgaW5zdGFuY2VvZiBCb29sZWFuKQ0KICAgICAgICAgICAgJiYgISh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpDQogICAgICAgICAgICAmJiAhKHZhbHVlIGluc3RhbmNlb2YgTnVtYmVyKQ0KICAgICAgICAgICAgJiYgISh2YWx1ZSBpbnN0YW5jZW9mIFJlZ0V4cCkNCiAgICAgICAgICAgICYmICEodmFsdWUgaW5zdGFuY2VvZiBTdHJpbmcpDQogICAgICAgICAgKSB7DQogICAgICAgICAgICBvbGRfcGF0aCA9IG9iamVjdHMuZ2V0KHZhbHVlKTsNCiAgICAgICAgICAgIGlmIChvbGRfcGF0aCAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgIHJldHVybiB7ICRyZWY6IG9sZF9wYXRoIH07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBvYmplY3RzLnNldCh2YWx1ZSwgcGF0aCk7DQogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsNCiAgICAgICAgICAgICAgbnUgPSBbXTsNCiAgICAgICAgICAgICAgdmFsdWUuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCwgaSkgew0KICAgICAgICAgICAgICAgIG51W2ldID0gZGVyZXooZWxlbWVudCwgcGF0aCArICdbJyArIGkgKyAnXScpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIG51ID0ge307DQogICAgICAgICAgICAgIE9iamVjdC5rZXlzKHZhbHVlKS5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7DQogICAgICAgICAgICAgICAgbnVbbmFtZV0gPSBkZXJleigNCiAgICAgICAgICAgICAgICAgIHZhbHVlW25hbWVdLA0KICAgICAgICAgICAgICAgICAgcGF0aCArICdbJyArIEpTT04uc3RyaW5naWZ5KG5hbWUpICsgJ10nDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbnU7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICAgICAgfShvYmplY3QsICckJykpOw0KICAgICAgfTsNCiAgICB9DQoNCiAgICBpZiAodHlwZW9mIFN0cmluZyAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBTdHJpbmcuXyRfdHJpbUluZGVudF8kXyAhPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgU3RyaW5nLnByb3RvdHlwZS5fJF90cmltSW5kZW50XyRfID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBjb25zdCBsaW5lcyA9IHRoaXMuc3BsaXQoJ1xuJykubWFwKChsaW5lKSA9PiBsaW5lLnJlcGxhY2UoJ1x0JywgJyAgJykpOw0KICAgICAgICBsZXQgbWluSW5kZW50ID0gTWF0aC5taW4oLi4ubGluZXMuc2xpY2UoMSkubWFwKChsaW5lKSA9PiBsaW5lLnNlYXJjaCgvXFN8JC8pKSk7DQogICAgICAgIHJldHVybiBtaW5JbmRlbnQgPT09IDAgPyBTdHJpbmcodGhpcykgOiBTdHJpbmcobGluZXMuc2xpY2UoMSkucmVkdWNlKChhY2MsIGxpbmUpID0+IGFjYyArICdcbicgKyBsaW5lLnN1YnN0cmluZyhtaW5JbmRlbnQpLCBsaW5lc1swXSkpOw0KICAgICAgfTsNCiAgICB9DQogICAgaWYgKHR5cGVvZiBTdHJpbmcuXyRfaW5kZW50XyRfICE9PSAnZnVuY3Rpb24nKSB7DQogICAgICBTdHJpbmcucHJvdG90eXBlLl8kX2luZGVudF8kXyA9IGZ1bmN0aW9uIChzcGFjZSkgew0KICAgICAgICByZXR1cm4gU3RyaW5nKHRoaXMuc3BsaXQoJ1xuJykucmVkdWNlKChhY2MsIGxpbmUsIGkpID0+IGFjYyArIChpID09PSAwID8gJycgOiAnXG4nKSArIHNwYWNlICsgbGluZSwgJycpKTsNCiAgICAgIH07DQogICAgfQ0KICAgIGlmICh0eXBlb2YgT2JqZWN0ICE9PSB1bmRlZmluZWQpIHsNCiAgICAgIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBKU09OLnN0cmluZ2lmeShKU09OLmRlY3ljbGUodGhpcyksIG51bGwsICcgICcpLl8kX3RyaW1JbmRlbnRfJF8oKTsgfTsNCiAgICB9DQogICAgaWYgKHR5cGVvZiBBcnJheSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICBBcnJheS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnJlZHVjZSgoYWNjLCBlbCwgaSwgYSkgPT4gYWNjICsgJ1xuJyArIGVsLnRvU3RyaW5nKCkuXyRfaW5kZW50XyRfKCcgICcpICsgKGkgPT09IGEubGVuZ3RoIC0gMSA/ICcnIDogJywnKSwgJ1snKSArICdcbl0nOyB9Ow0KICAgIH0NCiAgICBpZiAodHlwZW9mIEVsZW1lbnQgIT09IHVuZGVmaW5lZCkgew0KICAgICAgRWxlbWVudC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLm91dGVySFRNTC5fJF90cmltSW5kZW50XyRfKCk7IH07DQogICAgfQ0KICAgIGlmICh0eXBlb2YgalF1ZXJ5ICE9PSB1bmRlZmluZWQpIHsNCiAgICAgIGpRdWVyeS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnRvQXJyYXkoKS50b1N0cmluZygpOyB9Ow0KICAgIH0NCiAgfSkoKTs="
